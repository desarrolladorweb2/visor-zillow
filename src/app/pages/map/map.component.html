<div class="main-layout">
    <header class="navbar-wrapper">
        <app-navbar></app-navbar>
    </header>

    <div class="content-body">
        <aside class="sidebar-wrapper">
            <app-sidebar [idVisor]="id ?? ''"></app-sidebar>
        </aside>

        <main class="viewer-container">

            <section class="map-section">
                <app-map-main #mapRef (propertiesInView)="updateListFromMap($event)"
                    (propertySelected)="onPropertySelected($event)" [idVisor]="id ?? ''"
                    class="map-component"></app-map-main>
            </section>

            <router-outlet></router-outlet>

            <div class="results-panel">
                @if (isLoading()) {
                <div class="loading-spinner">
                    <p>Buscando...</p>
                </div>
                @for (i of [1,2,3,4]; track i) {
                <div class="skeleton-card">
                    <div class="skeleton-img"></div>
                    <div class="skeleton-content">
                        <div class="skeleton-line price"></div>
                        <div class="skeleton-line address"></div>
                        <div class="skeleton-line detail"></div>
                    </div>
                </div>}
                } @else {
                <div class="filters-bar">
                    <div class="filter-group">

                        <select class="filter-select" (change)="updateFilter('valor_inmueble', $event)">
                            <option value="">Rango de Precio</option>
                            @for (precio of filterOptions.precios; track precio.value) {
                            <option [value]="precio.value">{{ precio.label }}</option>
                            }
                        </select>

                        <select class="filter-select" (change)="updateFilter('tipo_bien_id', $event)">
                            <option value="">Tipo de Bien</option>
                            @for (tipo of filterOptions.tiposBien; track tipo.id) {
                            <option [value]="tipo.id">{{ tipo.label }}</option>
                            }
                        </select>

                        <select class="filter-select" (change)="updateFilter('tipo_predio_id', $event)">
                            <option value="">Tipo Predio</option>
                            @for (predio of filterOptions.tiposPredio; track predio.id) {
                            <option [value]="predio.id">{{ predio.label }}</option>
                            }
                        </select>

                        <select class="filter-select" (change)="updateFilter('clasificacion_id', $event)">
                            <option value="">Clasificaci√≥n</option>
                            @for (clasif of filterOptions.clasificaciones; track clasif.id) {
                            <option [value]="clasif.id">{{ clasif.label }}</option>
                            }
                        </select>

                        <select class="filter-select" (change)="updateFilter('departamento_id', $event)">
                            <option value="">Departamento</option>
                            @for (depto of filterOptions.departamentos; track depto.id) {
                            <option [value]="depto.id">{{ depto.label }}</option>
                            }
                        </select>

                        <select class="filter-select" (change)="updateFilter('municipio_id', $event)">
                            <option value="">Municipio</option>
                            @for (mun of filterOptions.municipios; track mun.id) {
                            <option [value]="mun.id">{{ mun.label }}</option>
                            }
                        </select>

                    </div>

                    <div class="results-count">
                        {{ filteredProperties().length | number }} resultados
                    </div>
                </div>
                <div class="results-grid">
                    @for (item of filteredProperties(); track item.id) {
                    <div class="card-wrapper" [class.highlighted-card]="item.id === selectedPropertyId()">
                        <app-container-card [property]="item"></app-container-card>
                    </div>
                    }
                </div>
                }

            </div>

        </main>
        <app-container-modal-card></app-container-modal-card>
        <app-container-modal-contact-card></app-container-modal-contact-card>
    </div>

    <footer class="footer-wrapper">
        <app-footer></app-footer>
    </footer>
</div>